(function(){$.extend({handlebar:function(t,e){var i;return null==e&&(e={}),null==Handlebars.templates[t]&&(i=$("script#"+t),i.length>0&&(Handlebars.templates[t]=Handlebars.compile(i.html()))),$(Handlebars.templates[t](e))},plush:function(t){var e;return e=$(t),e.data("plush",new Plush(e))}}),$.fn.extend({plush:function(){return this.each(function(){return $.plush(this)})}})}).call(this),function(){this.Plush=function(){function t(t,e){var i,s,n,l,a,o,r,h,p=this;this.element=t,this.options=null!=e?e:{},this.element.hide(),this.element.wrap('<div class="plush-container"></div>'),this.container=this.element.parent(),this.container.append($.handlebar("plush_input",{placeholder:this.element.attr("placeholder")})),this.list=$(".plush-option-list",this.container),this.inputContainer=$(".plush-input-wrapper",this.container),this.placeholder=$(".plush-placeholder",this.inputContainer),this.input=$("input",this.inputContainer),this.options.multiple=null!=this.options.multiple||null!=this.element.attr("multiple"),this.options.dragDrop=null!=this.options.drag_drop||null!=this.element.data("drag-drop"),this.searchWithAjax=null!=this.element.data("query"),this.setQueryDataOptions(),null==this.queryData&&(this.queryData={}),this.queryDefault="q",s={noResults:"No results found for: ",labelMethod:"label",listItemTemplate:"plush_list_item",optgroupTemplate:"plush_optgroup_item",multiSelectTemplate:"plush_multi_select_item",position:"bottom",url:null};for(n in s)o=s[n],this.setDefaultOption(n,o);if(this.list.addClass(this.options.listItemTemplate.replace(/\_/g,"-")),this.container.addClass("position-"+this.options.position),null!=this.options.multiple&&this.container.addClass("plush-multiple"),this.element.attr("tabindex",-1),$("option[selected]",this.element).length>0&&!this.options.multiple&&(this.placeholder.html($("option[selected]",this.element).html()),this.input.val($("option[selected]",this.element).html())),null!=this.options.url&&this.createListFromSource(!0),null==this.options.url&&($("optgroup",this.element).length>0?this.createListFromGroupedOptions():this.createListFromOptions()),this.options.multiple)for(a=$("option[selected]",this.element),this.element.html(""),r=0,h=a.length;h>r;r++)l=a[r],i=$(l),this.addMultiSelectItem(i.html(),i.val());return this.options.multiple||(null!=this.element.attr("placeholder")?this.element.prop("selectedIndex",-1):this.setOptionFor($("li:first-child",this.list))),this.options.dragDrop&&this.inputContainer.sortable({items:"> .plush-multi-select-item",stop:function(t,e){return p.moveMultiSelectItem(e.item)}}),this.inputContainer.on("click",".plush-placeholder, .plush-caret",function(t){return t.preventDefault(),p.show()}).on("click",function(t){return p.options.multiple&&$(t.target).hasClass("plush-input-wrapper")?p.show():void 0}).on("click",".plush-remove",function(t){var e;return t.preventDefault(),e=$(t.currentTarget).parents(".plush-multi-select-item").first(),p.removeOption(e.data("value")),e.remove()}),this.container.on("blur","input, a",function(){return setTimeout(p.bind(p.hide),100)}),this.input.on("focus",function(){return p.inputContainer.hasClass("opened")?void 0:p.show()}).on("keyup",function(t){return t.stopPropagation(),p.handleInputKeyPress(t)}),this.list.on("mousedown","a",function(t){var e;return t.preventDefault(),t.stopPropagation(),e=$(t.currentTarget).parents("li").first(),p.options.multiple?p.addOptionFor(e):(p.setOptionFor(e),p.hide(!0))}).on("click","a",function(t){return t.preventDefault()}).on("keydown","a",function(t){return t.preventDefault(),t.stopPropagation()}).on("keyup","a",function(t){return t.preventDefault(),t.stopPropagation(),p.handleListKeyPress(t)}).on("blur","a",function(){return $(this).removeClass("focused")}),this.element.trigger("initialized"),this}return t.prototype.handleInputKeyPress=function(t){return 38!==t.which&&40!==t.which?this.searchWithAjax?this.delayedSearch():this.search(this.input.val()):(t.preventDefault(),38===t.which&&this.focusAnchor($("li:not(.hidden):last a",this.list)),40===t.which?this.focusAnchor($("li:not(.hidden):first a",this.list)):void 0)},t.prototype.handleListKeyPress=function(t){var e,i,s;return e=$(t.currentTarget),(38===t.which||40===t.which)&&(38===t.which&&(s=this.prevAnchor(e)),40===t.which&&(s=this.nextAnchor(e)),!s.length>0?this.input.focus():this.focusAnchor(s)),27===t.which&&this.input.focus(),13===t.which?(e=$(t.currentTarget),i=e.parents("li").first(),null!=this.options.multiple&&this.options.multiple?this.addOptionFor(i):(this.setOptionFor(i),this.blurAnchor(e))):void 0},t.prototype.setDefaultOption=function(t,e){var i;return null==this.options[t]?(i=t.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()}),this.options[t]=this.element.data(i)||e):void 0},t.prototype.setQueryDataOptions=function(){return this.queryData=this.getQueryDataFromElement(this.element.get(0))},t.prototype.setOptionFor=function(t){return this.placeholder.html(t.data("label")),this.element.val(t.data("value")),this.element.trigger("change")},t.prototype.addOptionFor=function(t){var e;return e=t.data("value"),0===$("option[value='"+e+"']",this.element).length?this.addMultiSelectItem(t.data("label"),e):void 0},t.prototype.addMultiSelectItem=function(t,e){var i;return i=$.handlebar(this.options.multiSelectTemplate,{label:t,value:e}),$(".plush-multi-select-item",this.inputContainer).length>0?$(".plush-multi-select-item",this.inputContainer).last().after(i):this.inputContainer.prepend(i),this.element.append("<option value="+e+" selected>"+t+"</option>"),this.element.trigger("change")},t.prototype.moveMultiSelectItem=function(t){var e,i,s;return e=$("[value="+t.data("value")+"]",this.element),t.prev().length>0?(i=t.prev(),s=$("[value="+i.data("value")+"]",this.element),$(s,this.element).after(e)):this.element.prepend(e),this.element.trigger("change")},t.prototype.removeOption=function(t){return $("option[value="+t+"]",this.element).removeAttr("selected"),this.options.multiple&&$("option[value="+t+"]",this.element).remove(),this.element.trigger("change")},t.prototype.focusAnchor=function(t){return t.focus(),t.addClass("focused")},t.prototype.blurAnchor=function(t){return t.blur(),t.removeClass("focused")},t.prototype.nextAnchor=function(t){var e,i;return e=t.parents("li").first(),i=$("a",e.next()),i&&!i.parents("li").first().hasClass("hidden")?i:this.nextAnchor(i)},t.prototype.prevAnchor=function(t){var e,i;return e=t.parents("li").first(),i=$("a",e.prev()),i&&!i.parents("li").first().hasClass("hidden")?i:this.prevAnchor(i)},t.prototype.createListFromOptions=function(){var t=this;return $("option",this.element).each(function(e,i){return t.list.append(t.createListItemFromOption(i))})},t.prototype.createListFromGroupedOptions=function(){var t=this;return $("optgroup",this.element).each(function(e,i){var s,n;return n=$(i),s=$.handlebar("plush_optgroup_item",{label:n.attr("label")}),$("option",n).each(function(e,i){return $(".plush-optgroup-list",s).append(t.createListItemFromOption(i))}),t.list.append(s)})},t.prototype.createListItemFromOption=function(t){var e,i;return e=$(t),i=this.getDataFromElement(t),i.value=e.val(),i.label=e.html(),$.handlebar(this.options.listItemTemplate,i)},t.prototype.createListFromSource=function(t){var e,i,s=this;return null==t&&(t=!1),this.inputContainer.addClass("loading"),e={url:this.options.url,type:"get",dataType:"json"},i=$.extend({},this.queryData),this.searchWithAjax&&(i[this.queryDefault]=this.input.val()),e.data=i,$.ajax(e).done(function(e){return s.createListFromJSON(e,t)}).always(function(){return s.inputContainer.removeClass("loading"),s.checkResults()})},t.prototype.hasFocus=function(){return $("*:focus",this.container).length>0},t.prototype.createListFromJSON=function(t,e){var i,s,n,l,a,o,r,h,p,u,c;if(null==t&&(t=[]),null==e&&(e=!1),this.list.empty(),null!=t&&!$.isEmptyObject(t)){if($.inArray("value",Object.keys(t[0]))>=0)for(a=0,h=t.length;h>a;a++)l=t[a],this.checkItemLabel(l),this.list.append(this.createListItemFromJson(l)),this.element.append("<option value="+l.value+">"+l.label+"</option>");else for(o=0,p=t.length;p>o;o++){for(n=t[o],s=Object.keys(n)[0],i=$.handlebar(this.options.optgroupTemplate,{label:s}),c=n[s],r=0,u=c.length;u>r;r++)l=c[r],this.checkItemLabel(l),$("ul",i).append(this.createListItemFromJson(l));this.list.append(i)}return e||this.input.focus(),this.checkResults()}},t.prototype.checkItemLabel=function(t){return null==t.label?t.label=t[this.options.labelMethod]:void 0},t.prototype.createListItemFromJson=function(t){return $.handlebar(this.options.listItemTemplate,t)},t.prototype.delayedSearch=function(){return null!=this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.bind(this.createListFromSource),500)},t.prototype.search=function(t){var e;return e=new RegExp(t,"i"),$(".plush-list-item a",this.container).each(function(){var t;return t=$(this).parents(".plush-list-item").first(),e.test($(this).html())?t.hasClass("disabled")?void 0:t.removeClass("hidden"):t.addClass("hidden")}),$(".plush-optgroup",this.container).each(function(){var t;return t=$(this),0===$(".plush-list-item:not(.hidden)",t).length?t.hide():t.show()}),this.resizeList(),this.checkResults()},t.prototype.checkResults=function(){return 0===$("li:not(.hidden)",this.list).length?this.showNoResults():this.hideNoResults()},t.prototype.showNoResults=function(){var t;return t=this.options.noResults+this.input.val(),0===$(".plush-no-results",this.list).length?this.list.append($("<div class='plush-no-results'>"+t+"</div>")):($(".plush-no-results",this.list).html(t),$(".plush-no-results",this.list).show())},t.prototype.hideNoResults=function(){return $(".plush-no-results",this.list).hide()},t.prototype.resizeInput=function(){},t.prototype.resizeList=function(){return"top"===this.options.position?this.list.css("top","-"+this.list.outerHeight(!0)+"px"):void 0},t.prototype.show=function(){return this.placeholder.hide(),this.input.css("display","block"),this.inputContainer.addClass("opened"),this.list.show(),this.input.is(":focus")?void 0:this.input.focus()},t.prototype.hide=function(t){return null==t&&(t=!1),!this.hasFocus()||t?(this.options.multiple||(this.placeholder.show(),this.input.hide()),this.inputContainer.removeClass("opened"),this.list.hide()):void 0},t.prototype.getAttributesFromElement=function(t,e){var i,s,n,l,a;for(s={},a=t.attributes,n=0,l=a.length;l>n;n++)i=a[n],i.nodeName.match(e)&&(s[i.nodeName.replace(e,"")]=i.nodeValue);return s},t.prototype.getDataFromElement=function(t){return this.getAttributesFromElement(t,/^data-/)},t.prototype.getQueryDataFromElement=function(t){return this.getAttributesFromElement(t,/^data-query-/)},t.prototype.bind=function(t){var e=this;return function(){return t.apply(e,arguments)}},t}(),$(function(){return $("[data-toggle='plush']").plush()})}.call(this),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_image_list_item=t(function(t,e,i,s,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var l,a="",o="function",r=this.escapeExpression;return a+="<li class='plush-list-item plush-imagebox' data-label='",(l=i.label)?l=l.call(e,{hash:{},data:n}):(l=e&&e.label,l=typeof l===o?l.call(e,{hash:{},data:n}):l),a+=r(l)+"' data-value='",(l=i.value)?l=l.call(e,{hash:{},data:n}):(l=e&&e.value,l=typeof l===o?l.call(e,{hash:{},data:n}):l),a+=r(l)+"'>\n  <a href='#'>\n    <img src='",(l=i.image)?l=l.call(e,{hash:{},data:n}):(l=e&&e.image,l=typeof l===o?l.call(e,{hash:{},data:n}):l),a+=r(l)+"'>\n    <span class='title'>",(l=i.label)?l=l.call(e,{hash:{},data:n}):(l=e&&e.label,l=typeof l===o?l.call(e,{hash:{},data:n}):l),a+=r(l)+"</span>\n    <span class='description'>",(l=i.description)?l=l.call(e,{hash:{},data:n}):(l=e&&e.description,l=typeof l===o?l.call(e,{hash:{},data:n}):l),a+=r(l)+"</span>\n  </a>\n</li>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_input=t(function(t,e,i,s,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var l,a="",o="function",r=this.escapeExpression;return a+="<div class='plush-input-wrapper'>\n  <div class='plush-placeholder'>",(l=i.placeholder)?l=l.call(e,{hash:{},data:n}):(l=e&&e.placeholder,l=typeof l===o?l.call(e,{hash:{},data:n}):l),a+=r(l)+"</div>\n  <input class='plush-input' type='text' value='",(l=i.value)?l=l.call(e,{hash:{},data:n}):(l=e&&e.value,l=typeof l===o?l.call(e,{hash:{},data:n}):l),a+=r(l)+"'>\n  <div class='plush-caret'></div>\n</div>\n<ul class='plush-option-list'></ul>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_list_item=t(function(t,e,i,s,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var l,a="",o="function";return a+="<li class='plush-list-item' data-label='",(l=i.label)?l=l.call(e,{hash:{},data:n}):(l=e&&e.label,l=typeof l===o?l.call(e,{hash:{},data:n}):l),(l||0===l)&&(a+=l),a+="' data-value='",(l=i.value)?l=l.call(e,{hash:{},data:n}):(l=e&&e.value,l=typeof l===o?l.call(e,{hash:{},data:n}):l),(l||0===l)&&(a+=l),a+="'>\n  <a href='#'>",(l=i.label)?l=l.call(e,{hash:{},data:n}):(l=e&&e.label,l=typeof l===o?l.call(e,{hash:{},data:n}):l),(l||0===l)&&(a+=l),a+="</a>\n</li>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_multi_select_item=t(function(t,e,i,s,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var l,a="",o="function",r=this.escapeExpression;return a+="<div class='plush-multi-select-item' data-value='",(l=i.value)?l=l.call(e,{hash:{},data:n}):(l=e&&e.value,l=typeof l===o?l.call(e,{hash:{},data:n}):l),a+=r(l)+"'>\n  <span>",(l=i.label)?l=l.call(e,{hash:{},data:n}):(l=e&&e.label,l=typeof l===o?l.call(e,{hash:{},data:n}):l),a+=r(l)+"</span>\n  <a class='plush-remove'></a>\n</div>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_optgroup_item=t(function(t,e,i,s,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var l,a="",o="function";return a+="<li class='plush-optgroup'>\n  <div class='plush-optgroup-label'>",(l=i.label)?l=l.call(e,{hash:{},data:n}):(l=e&&e.label,l=typeof l===o?l.call(e,{hash:{},data:n}):l),(l||0===l)&&(a+=l),a+="</div>\n  <ul class='plush-optgroup-list'></ul>\n</li>\n"})}(),function(){}.call(this);