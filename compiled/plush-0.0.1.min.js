(function(){$.extend({handlebar:function(t,e){var s;return null==e&&(e={}),null==Handlebars.templates[t]&&(s=$("script#"+t),s.length>0&&(Handlebars.templates[t]=Handlebars.compile(s.html()))),$(Handlebars.templates[t](e))},plush:function(t){var e;return e=$(t),e.data("plush",new Plush(e))}}),$.fn.extend({plush:function(){return this.each(function(){return $.plush(this)})}})}).call(this),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_image_list_item=t(function(t,e,s,l,i){this.compilerInfo=[4,">= 1.0.0"],s=this.merge(s,t.helpers),i=i||{};var a,n="",o="function",r=this.escapeExpression;return n+="<li class='plush-list-item plush-imagebox' data-label='",(a=s.label)?a=a.call(e,{hash:{},data:i}):(a=e&&e.label,a=typeof a===o?a.call(e,{hash:{},data:i}):a),n+=r(a)+"' data-value='",(a=s.value)?a=a.call(e,{hash:{},data:i}):(a=e&&e.value,a=typeof a===o?a.call(e,{hash:{},data:i}):a),n+=r(a)+"'>\n  <a href='#'>\n    <img src='",(a=s.image)?a=a.call(e,{hash:{},data:i}):(a=e&&e.image,a=typeof a===o?a.call(e,{hash:{},data:i}):a),n+=r(a)+"'>\n    <span class='title'>",(a=s.label)?a=a.call(e,{hash:{},data:i}):(a=e&&e.label,a=typeof a===o?a.call(e,{hash:{},data:i}):a),n+=r(a)+"</span>\n    <span class='description'>",(a=s.description)?a=a.call(e,{hash:{},data:i}):(a=e&&e.description,a=typeof a===o?a.call(e,{hash:{},data:i}):a),n+=r(a)+"</span>\n  </a>\n</li>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_input=t(function(t,e,s,l,i){this.compilerInfo=[4,">= 1.0.0"],s=this.merge(s,t.helpers),i=i||{};var a,n="",o="function",r=this.escapeExpression;return n+="<div class='plush-input'>\n  <div class='plush-placeholder'>",(a=s.placeholder)?a=a.call(e,{hash:{},data:i}):(a=e&&e.placeholder,a=typeof a===o?a.call(e,{hash:{},data:i}):a),n+=r(a)+"</div>\n  <input class='' type='text' value='",(a=s.value)?a=a.call(e,{hash:{},data:i}):(a=e&&e.value,a=typeof a===o?a.call(e,{hash:{},data:i}):a),n+=r(a)+"'>\n  <div class='plush-caret'></div>\n</div>\n<ul class='plush-option-list'></ul>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_list_item=t(function(t,e,s,l,i){this.compilerInfo=[4,">= 1.0.0"],s=this.merge(s,t.helpers),i=i||{};var a,n="",o="function";return n+="<li class='plush-list-item' data-label='",(a=s.label)?a=a.call(e,{hash:{},data:i}):(a=e&&e.label,a=typeof a===o?a.call(e,{hash:{},data:i}):a),(a||0===a)&&(n+=a),n+="' data-value='",(a=s.value)?a=a.call(e,{hash:{},data:i}):(a=e&&e.value,a=typeof a===o?a.call(e,{hash:{},data:i}):a),(a||0===a)&&(n+=a),n+="'>\n  <a href='#'>",(a=s.label)?a=a.call(e,{hash:{},data:i}):(a=e&&e.label,a=typeof a===o?a.call(e,{hash:{},data:i}):a),(a||0===a)&&(n+=a),n+="</a>\n</li>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_multi_select_item=t(function(t,e,s,l,i){this.compilerInfo=[4,">= 1.0.0"],s=this.merge(s,t.helpers),i=i||{};var a,n="",o="function",r=this.escapeExpression;return n+="<div class='plush-multi-select-item' data-value='",(a=s.value)?a=a.call(e,{hash:{},data:i}):(a=e&&e.value,a=typeof a===o?a.call(e,{hash:{},data:i}):a),n+=r(a)+"'>\n  ",(a=s.label)?a=a.call(e,{hash:{},data:i}):(a=e&&e.label,a=typeof a===o?a.call(e,{hash:{},data:i}):a),n+=r(a)+"\n</div>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_optgroup_item=t(function(t,e,s,l,i){this.compilerInfo=[4,">= 1.0.0"],s=this.merge(s,t.helpers),i=i||{};var a,n="",o="function";return n+="<li class='plush-optgroup'>\n  <div class='plush-optgroup-label'>",(a=s.label)?a=a.call(e,{hash:{},data:i}):(a=e&&e.label,a=typeof a===o?a.call(e,{hash:{},data:i}):a),(a||0===a)&&(n+=a),n+="</div>\n  <ul class='plush-optgroup-list'></ul>\n</li>\n"})}(),function(){this.Plush=function(){function t(t,e){var s,l,i,a=this;this.element=t,this.options=null!=e?e:{},this.element.hide(),this.element.wrap('<div class="plush-container"></div>'),this.container=this.element.parent(),this.container.append($.handlebar("plush_input",{placeholder:this.element.attr("placeholder")})),this.list=$(".plush-option-list",this.container),this.inputContainer=$(".plush-input",this.container),this.placeholder=$(".plush-placeholder",this.inputContainer),this.input=$("input",this.inputContainer),this.options.multiple=null!=this.options.multiple||null!=this.element.attr("multiple"),this.searchWithAjax=null!=this.element.data("query"),this.dataDefaults={},this.queryDefault="q",s={noResults:"No results found for: ",labelMethod:"label",listItemTemplate:"plush_list_item",optgroupTemplate:"plush_optgroup_item",multiSelectTemplate:"plush_multi_select_item",position:"bottom",url:null};for(l in s)i=s[l],this.setDefaultOption(l,i);return this.list.addClass(this.options.listItemTemplate.replace(/\_/g,"-")),this.container.addClass("position-"+this.options.position),this.element.attr("tabindex",-1),$("option[selected]",this.element).length>0&&!this.options.multiple&&(this.placeholder.html($("option[selected]",this.element).html()),this.input.val($("option[selected]",this.element).html())),null!=this.options.url?this.createListFromSource():$("optgroup",this.element).length>0?this.createListFromGroupedOptions():this.createListFromOptions(),null!=this.element.attr("placeholder")?this.element.prop("selectedIndex",-1):this.setOptionFor($("li:first-child",this.list)),this.inputContainer.on("click",".plush-placeholder, .plush-caret",function(t){return t.preventDefault(),a.show()}),this.container.on("blur","input, a",function(){return setTimeout(a.bind(a.hide),100)}),this.input.on("focus",function(){return a.inputContainer.hasClass("opened")?void 0:a.show()}).on("keyup",function(t){return t.stopPropagation(),a.handleInputKeyPress(t)}),this.list.on("click","a",function(t){return t.preventDefault(),t.stopPropagation(),a.options.multiple?a.addOptionFor($(t.currentTarget).parents("li").first()):(a.setOptionFor($(t.currentTarget).parents("li").first()),a.hide())}).on("keydown","a",function(t){return t.preventDefault(),t.stopPropagation()}).on("keyup","a",function(t){return t.preventDefault(),t.stopPropagation(),a.handleListKeyPress(t)}),this.element.trigger("initialized"),this}return t.prototype.handleInputKeyPress=function(t){return 38!==t.keyCode&&40!==t.keyCode?this.searchWithAjax?this.delayedSearch():this.search(this.input.val()):(t.preventDefault(),38===t.keyCode&&$("li:not(.hidden):last a",this.list).focus(),40===t.keyCode?$("li:not(.hidden):first a",this.list).focus():void 0)},t.prototype.handleListKeyPress=function(t){var e,s;return e=$(t.currentTarget),(38===t.keyCode||40===t.keyCode)&&(38===t.keyCode&&(s=this.prevAnchor(e)),40===t.keyCode&&(s=this.nextAnchor(e)),!s.length>0?this.input.focus():s.focus()),27===t.keyCode&&this.input.focus(),13===t.keyCode?(e=$(t.currentTarget),this.setOptionFor(e.parents("li").first()),e.blur()):void 0},t.prototype.setDefaultOption=function(t,e){var s;return null==this.options[t]?(s=t.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()}),this.options[t]=this.element.data(s)||e):void 0},t.prototype.setOptionFor=function(t){return this.placeholder.html(t.data("label")),this.element.val(t.data("value")),this.element.trigger("change")},t.prototype.addOptionFor=function(t){var e;return e=$.handlebar("plush_multi_select_item",{label:t.data("label"),value:t.data("value")}),this.inputContainer.prepend(e),this.element.trigger("change")},t.prototype.nextAnchor=function(t){var e,s;return e=t.parents("li").first(),s=$("a",e.next()),s&&!s.parents("li").first().hasClass("hidden")?s:this.nextAnchor(s)},t.prototype.prevAnchor=function(t){var e,s;return e=t.parents("li").first(),s=$("a",e.prev()),s&&!s.parents("li").first().hasClass("hidden")?s:this.prevAnchor(s)},t.prototype.createListFromOptions=function(){var t=this;return $("option",this.element).each(function(e,s){return t.list.append(t.createListItemFromOption(s))})},t.prototype.createListFromGroupedOptions=function(){var t=this;return $("optgroup",this.element).each(function(e,s){var l,i;return i=$(s),l=$.handlebar("plush_optgroup_item",{label:i.attr("label")}),$("option",i).each(function(e,s){return $(".plush-optgroup-list",l).append(t.createListItemFromOption(s))}),t.list.append(l)})},t.prototype.createListItemFromOption=function(t){var e,s;return e=$(t),s=this.getAttributesFromElement(t),s.value=e.val(),s.label=e.html(),$.handlebar(this.options.listItemTemplate,s)},t.prototype.createListFromSource=function(){var t,e,s=this;return this.inputContainer.addClass("loading"),t={url:this.options.url,type:"get",dataType:"json"},e=this.dataDefaults,this.searchWithAjax&&(e[this.queryDefault]=this.input.val()),t.data=e,$.ajax(t).done(function(t){return s.createListFromJSON(t)}).always(function(){return s.inputContainer.removeClass("loading"),s.checkResults()})},t.prototype.hasFocus=function(){return $("*:focus",this.container).length>0},t.prototype.createListFromJSON=function(t){var e,s,l,i,a,n,o,r,h,p,u;if(null==t&&(t=[]),this.list.empty(),null!=t&&!$.isEmptyObject(t)){if($.inArray("value",Object.keys(t[0]))>=0)for(a=0,r=t.length;r>a;a++)i=t[a],null==i.label&&(i.label=i[this.options.labelMethod]),this.list.append($.handlebar(this.options.listItemTemplate,i)),this.element.append("<option value="+i.value+">"+i.label+"</option>");else for(n=0,h=t.length;h>n;n++){for(l=t[n],s=Object.keys(l)[0],e=$.handlebar(this.options.optgroupTemplate,{label:s}),u=l[s],o=0,p=u.length;p>o;o++)i=u[o],null==i.label&&(i.label=i[this.options.labelMethod]),$("ul",e).append($.handlebar(this.options.listItemTemplate,i));this.list.append(e)}return this.input.focus(),this.checkResults()}},t.prototype.delayedSearch=function(){return null!=this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.bind(this.createListFromSource),500)},t.prototype.search=function(t){var e;return e=new RegExp(t,"i"),$(".plush-list-item a",this.container).each(function(){var t;return t=$(this),e.test(t.html())?t.parents(".plush-list-item").first().removeClass("hidden"):t.parents(".plush-list-item").first().addClass("hidden")}),$(".plush-optgroup",this.container).each(function(){var t;return t=$(this),0===$(".plush-list-item:not(.hidden)",t).length?t.hide():t.show()}),this.checkResults()},t.prototype.checkResults=function(){return 0===$("li:not(.hidden)",this.list).length?this.showNoResults():this.hideNoResults()},t.prototype.showNoResults=function(){var t;return t=this.options.noResults+this.input.val(),0===$(".plush-no-results",this.list).length?this.list.append($("<div class='plush-no-results'>"+t+"</div>")):($(".plush-no-results",this.list).html(t),$(".plush-no-results",this.list).show())},t.prototype.hideNoResults=function(){return $(".plush-no-results",this.list).hide()},t.prototype.show=function(){return this.placeholder.hide(),this.input.css("display","block"),this.inputContainer.addClass("opened"),this.list.show(),this.input.is(":focus")?void 0:this.input.focus()},t.prototype.hide=function(){return this.hasFocus()?void 0:(this.options.multiple||(this.placeholder.show(),this.input.hide()),this.inputContainer.removeClass("opened"),this.list.hide())},t.prototype.getAttributesFromElement=function(t){var e,s,l,i,a;for(s={},a=t.attributes,l=0,i=a.length;i>l;l++)e=a[l],e.nodeName.match(/^data-/)&&(s[e.nodeName.replace(/^data-/,"")]=e.nodeValue);return s},t.prototype.bind=function(t){var e=this;return function(){return t.apply(e,arguments)}},t}(),$(function(){return $("[data-toggle='plush']").plush()})}.call(this),function(){}.call(this);