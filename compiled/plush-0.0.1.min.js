(function(){$.extend({handlebar:function(t,e){var l;return null==e&&(e={}),null==Handlebars.templates[t]&&(l=$("script#"+t),l.length>0&&(Handlebars.templates[t]=Handlebars.compile(l.html()))),$(Handlebars.templates[t](e))},plush:function(t){var e;return e=$(t),e.data("plush",new Plush(e))}}),$.fn.extend({plush:function(){return this.each(function(){return $.plush(this)})}})}).call(this),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_image_list_item=t(function(t,e,l,s,a){this.compilerInfo=[4,">= 1.0.0"],l=this.merge(l,t.helpers),a=a||{};var i,n="",o="function",r=this.escapeExpression;return n+="<li class='plush-list-item plush-imagebox' data-label='",(i=l.label)?i=i.call(e,{hash:{},data:a}):(i=e&&e.label,i=typeof i===o?i.call(e,{hash:{},data:a}):i),n+=r(i)+"' data-value='",(i=l.value)?i=i.call(e,{hash:{},data:a}):(i=e&&e.value,i=typeof i===o?i.call(e,{hash:{},data:a}):i),n+=r(i)+"'>\n  <a href='#'>\n    <img src='",(i=l.image)?i=i.call(e,{hash:{},data:a}):(i=e&&e.image,i=typeof i===o?i.call(e,{hash:{},data:a}):i),n+=r(i)+"'>\n    <span class='title'>",(i=l.label)?i=i.call(e,{hash:{},data:a}):(i=e&&e.label,i=typeof i===o?i.call(e,{hash:{},data:a}):i),n+=r(i)+"</span>\n    <span class='description'>",(i=l.description)?i=i.call(e,{hash:{},data:a}):(i=e&&e.description,i=typeof i===o?i.call(e,{hash:{},data:a}):i),n+=r(i)+"</span>\n  </a>\n</li>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_input=t(function(t,e,l,s,a){this.compilerInfo=[4,">= 1.0.0"],l=this.merge(l,t.helpers),a=a||{};var i,n="",o="function",r=this.escapeExpression;return n+="<div class='plush-input'>\n  <div class='plush-placeholder'>",(i=l.placeholder)?i=i.call(e,{hash:{},data:a}):(i=e&&e.placeholder,i=typeof i===o?i.call(e,{hash:{},data:a}):i),n+=r(i)+"</div>\n  <input class='' type='text' value='",(i=l.value)?i=i.call(e,{hash:{},data:a}):(i=e&&e.value,i=typeof i===o?i.call(e,{hash:{},data:a}):i),n+=r(i)+"'>\n  <div class='plush-caret'></div>\n</div>\n<ul class='plush-option-list'></ul>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_list_item=t(function(t,e,l,s,a){this.compilerInfo=[4,">= 1.0.0"],l=this.merge(l,t.helpers),a=a||{};var i,n="",o="function";return n+="<li class='plush-list-item' data-label='",(i=l.label)?i=i.call(e,{hash:{},data:a}):(i=e&&e.label,i=typeof i===o?i.call(e,{hash:{},data:a}):i),(i||0===i)&&(n+=i),n+="' data-value='",(i=l.value)?i=i.call(e,{hash:{},data:a}):(i=e&&e.value,i=typeof i===o?i.call(e,{hash:{},data:a}):i),(i||0===i)&&(n+=i),n+="'>\n  <a href='#'>",(i=l.label)?i=i.call(e,{hash:{},data:a}):(i=e&&e.label,i=typeof i===o?i.call(e,{hash:{},data:a}):i),(i||0===i)&&(n+=i),n+="</a>\n</li>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_multi_select_item=t(function(t,e,l,s,a){this.compilerInfo=[4,">= 1.0.0"],l=this.merge(l,t.helpers),a=a||{};var i,n="",o="function",r=this.escapeExpression;return n+="<div class='plush-multi-select-item' data-value='",(i=l.value)?i=i.call(e,{hash:{},data:a}):(i=e&&e.value,i=typeof i===o?i.call(e,{hash:{},data:a}):i),n+=r(i)+"'>\n  ",(i=l.label)?i=i.call(e,{hash:{},data:a}):(i=e&&e.label,i=typeof i===o?i.call(e,{hash:{},data:a}):i),n+=r(i)+"\n</div>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_optgroup_item=t(function(t,e,l,s,a){this.compilerInfo=[4,">= 1.0.0"],l=this.merge(l,t.helpers),a=a||{};var i,n="",o="function";return n+="<li class='plush-optgroup'>\n  <div class='plush-optgroup-label'>",(i=l.label)?i=i.call(e,{hash:{},data:a}):(i=e&&e.label,i=typeof i===o?i.call(e,{hash:{},data:a}):i),(i||0===i)&&(n+=i),n+="</div>\n  <ul class='plush-optgroup-list'></ul>\n</li>\n"})}(),function(){this.Plush=function(){function t(t,e){var l,s,a,i=this;this.element=t,this.options=null!=e?e:{},this.element.hide(),this.element.wrap('<div class="plush-container"></div>'),this.container=this.element.parent(),this.container.append($.handlebar("plush_input",{placeholder:this.element.attr("placeholder")})),this.list=$(".plush-option-list",this.container),this.inputContainer=$(".plush-input",this.container),this.placeholder=$(".plush-placeholder",this.inputContainer),this.input=$("input",this.inputContainer),this.options.multiple=null!=this.options.multiple||null!=this.element.attr("multiple"),this.searchWithAjax=null!=this.element.data("query"),this.dataDefaults={},this.queryDefault="q",l={noResults:"No results found for: ",labelMethod:"label",listItemTemplate:"plush_list_item",optgroupTemplate:"plush_optgroup_item",multiSelectTemplate:"plush_multi_select_item",position:"bottom",url:null};for(s in l)a=l[s],this.setDefaultOption(s,a);return this.list.addClass(this.options.listItemTemplate.replace(/\_/g,"-")),this.container.addClass("position-"+this.options.position),this.element.attr("tabindex",-1),$("option[selected]",this.element).length>0&&!this.options.multiple&&(this.placeholder.html($("option[selected]",this.element).html()),this.input.val($("option[selected]",this.element).html())),null!=this.options.url?this.createListFromSource():$("optgroup",this.element).length>0?this.createListFromGroupedOptions():this.createListFromOptions(),null!=this.element.attr("placeholder")?this.element.prop("selectedIndex",-1):this.setOptionFor($("li:first-child",this.list)),this.inputContainer.on("click",".plush-placeholder, .plush-caret",function(t){return t.preventDefault(),i.showInput()}),this.input.on("focus",function(){return i.showList()}).on("blur",function(){return setTimeout(i.bind(i.hideList),200),i.options.multiple?void 0:i.hideInput()}).on("keyup",function(){var t;return i.searchWithAjax?i.delayedSearch():(t=new RegExp(i.input.val(),"i"),$(".plush-list-item a",i.container).each(function(){var e;return e=$(this),t.test(e.html())?e.parents(".plush-list-item").first().removeClass("hidden"):e.parents(".plush-list-item").first().addClass("hidden")}),$(".plush-optgroup",i.container).each(function(){var t;return t=$(this),0===$(".plush-list-item:not(.hidden)",t).length?t.hide():t.show()}),0===$("li:visible",i.list).length?i.showNoResults():i.hideNoResults())}),this.list.on("click","a",function(t){return t.preventDefault(),i.options.multiple?i.addOptionFor($(t.currentTarget).parents("li").first()):(i.setOptionFor($(t.currentTarget).parents("li").first()),i.hideList(),i.options.multiple?void 0:i.hideInput())}),this.element.trigger("initialized"),this}return t.prototype.setDefaultOption=function(t,e){var l;return null==this.options[t]?(l=t.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()}),this.options[t]=this.element.data(l)||e):void 0},t.prototype.setOptionFor=function(t){return this.placeholder.html(t.data("label")),this.element.val(t.data("value")),this.element.trigger("change")},t.prototype.addOptionFor=function(t){var e;return e=$.handlebar("plush_multi_select_item",{label:t.data("label"),value:t.data("value")}),this.inputContainer.prepend(e),this.element.trigger("change")},t.prototype.createListFromOptions=function(){var t=this;return $("option",this.element).each(function(e,l){return t.list.append(t.createListItemFromOption(l))})},t.prototype.createListFromGroupedOptions=function(){var t=this;return $("optgroup",this.element).each(function(e,l){var s,a;return a=$(l),s=$.handlebar("plush_optgroup_item",{label:a.attr("label")}),$("option",a).each(function(e,l){return $(".plush-optgroup-list",s).append(t.createListItemFromOption(l))}),t.list.append(s)})},t.prototype.createListItemFromOption=function(t){var e,l;return e=$(t),l=this.getAttributesFromElement(t),l.value=e.val(),l.label=e.html(),$.handlebar(this.options.listItemTemplate,l)},t.prototype.createListFromSource=function(){var t,e,l=this;return this.inputContainer.addClass("loading"),t={url:this.options.url,type:"get",dataType:"json"},e=this.dataDefaults,this.searchWithAjax&&(e[this.queryDefault]=this.input.val()),t.data=e,$.ajax(t).done(function(t){return l.createListFromJSON(t)}).always(function(){return l.inputContainer.removeClass("loading"),l.checkResults()})},t.prototype.createListFromJSON=function(t){var e,l,s,a,i,n,o,r,h,p,u;if(null==t&&(t=[]),this.list.empty(),null!=t&&!$.isEmptyObject(t)){if($.inArray("value",Object.keys(t[0]))>=0)for(i=0,r=t.length;r>i;i++)a=t[i],null==a.label&&(a.label=a[this.options.labelMethod]),this.list.append($.handlebar(this.options.listItemTemplate,a)),this.element.append("<option value="+a.value+">"+a.label+"</option>");else for(n=0,h=t.length;h>n;n++){for(s=t[n],l=Object.keys(s)[0],e=$.handlebar(this.options.optgroupTemplate,{label:l}),u=s[l],o=0,p=u.length;p>o;o++)a=u[o],null==a.label&&(a.label=a[this.options.labelMethod]),$("ul",e).append($.handlebar(this.options.listItemTemplate,a));this.list.append(e)}return this.checkResults()}},t.prototype.delayedSearch=function(){return null!=this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.bind(this.createListFromSource),500)},t.prototype.checkResults=function(){return 0===$("li:not(.hidden)",this.list).length?this.showNoResults():this.hideNoResults()},t.prototype.showNoResults=function(){var t;return t=this.options.noResults+this.input.val(),0===$(".plush-no-results",this.list).length?this.list.append($("<div class='plush-no-results'>"+t+"</div>")):($(".plush-no-results",this.list).html(t),$(".plush-no-results",this.list).show())},t.prototype.hideNoResults=function(){return $(".plush-no-results",this.list).hide()},t.prototype.showInput=function(){return this.placeholder.hide(),this.input.css("display","block"),this.input.focus()},t.prototype.hideInput=function(){return this.placeholder.show(),this.input.hide()},t.prototype.showList=function(){return this.inputContainer.addClass("opened"),this.list.show()},t.prototype.hideList=function(){return this.inputContainer.removeClass("opened"),this.list.hide()},t.prototype.getAttributesFromElement=function(t){var e,l,s,a,i;for(l={},i=t.attributes,s=0,a=i.length;a>s;s++)e=i[s],e.nodeName.match(/^data-/)&&(l[e.nodeName.replace(/^data-/,"")]=e.nodeValue);return l},t.prototype.bind=function(t){var e=this;return function(){return t.apply(e,arguments)}},t}(),$(function(){return $("[data-toggle='plush']").plush()})}.call(this),function(){}.call(this);