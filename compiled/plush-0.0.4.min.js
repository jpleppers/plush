(function(){$.extend({handlebar:function(t,e){var s;return null==e&&(e={}),null==Handlebars.templates[t]&&(s=$("script#"+t),s.length>0&&(Handlebars.templates[t]=Handlebars.compile(s.html()))),$(Handlebars.templates[t](e))},plush:function(t){var e;return e=$(t),e.data("plush",null!=e.attr("multiple")?new PlushMulti(e):new Plush(e))}}),$.fn.extend({plush:function(){return this.each(function(){return $.plush(this)})}})}).call(this),function(){this.Plush=function(){function t(t,e){var s,n,i;this.element=t,this.options=null!=e?e:{},this.element.hide(),this.element.wrap('<div class="plush-container"></div>'),this.container=this.element.parent(),this.container.append($.handlebar("plush_input",{placeholder:this.element.attr("placeholder")})),this.list=$(".plush-option-list",this.container),this.inputContainer=$(".plush-input-wrapper",this.container),this.placeholder=$(".plush-placeholder",this.inputContainer),this.input=$("input",this.inputContainer),this.queryData=this.getQueryDataFromElement(this.element.get(0)),null==this.queryData&&(this.queryData={}),this.searchWithAjax=null!=this.element.data("query"),i=this.defaults;for(s in i)n=i[s],this.setDefaultOption(s,n);return this.addClassnames(),this.setPlaceholders(),this.element.attr("tabindex",-1),null!=this.options.url?!this.searchWithAjax||this.searchWithAjax&&this.options.preload?this.createListFromSource(!0):this.checkResults():$("optgroup",this.element).length>0?this.createListFromGroupedOptions():this.createListFromOptions(),this.setup(),this.setEventHandlers(),this}return t.prototype.defaults={labelMethod:"label",listItemTemplate:"plush_list_item",optgroupTemplate:"plush_optgroup_item",multiSelectTemplate:"plush_multi_select_item",noResultsTemplate:"plush_no_results",noResultsMessage:"No results were found for: ",position:"bottom",url:null,preload:!1,queryDefault:"q"},t.prototype.setPlaceholders=function(){return $("option[selected]",this.element).length>0?(this.placeholder.html($("option[selected]",this.element).html()),this.input.val($("option[selected]",this.element).html())):void 0},t.prototype.setup=function(){return null!=this.element.attr("placeholder")?this.element.prop("selectedIndex",-1):this.setOptionFor($("li:first-child",this.list))},t.prototype.addClassnames=function(){return this.list.addClass(this.options.listItemTemplate.replace(/\_/g,"-")),this.container.addClass("position-"+this.options.position)},t.prototype.setDefaultOption=function(t,e){var s;return null==this.options[t]?(s=t.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()}),this.options[t]=this.element.data(s)||e):void 0},t.prototype.setOptionFor=function(t){return this.placeholder.html(t.data("label")),this.searchWithAjax?this.createOption(t.data("label"),t.data("value")):this.element.val(t.data("value")),this.hide(!0),this.element.trigger("change")},t.prototype.createOption=function(t,e,s){return null==s&&(s=!0),this.getOption(e).length>0?void 0:(this.element.append("<option value="+e+(s?" selected":"")+">"+t+"</option>"),this.element.trigger("change"))},t.prototype.removeOption=function(t){return $("option[value="+t+"]",this.element).removeAttr("selected"),this.options.multiple?$("option[value="+t+"]",this.element).remove():void 0},t.prototype.getOption=function(t){var e;return e=$("[value="+t+"]",this.element)},t.prototype.focusAnchor=function(t){return t.focus(),t.addClass("focused")},t.prototype.blurAnchor=function(t){return t.blur(),t.removeClass("focused")},t.prototype.nextAnchor=function(t){var e,s;return e=t.parents("li").first(),s=$("a",e.next()),s&&!s.parents("li").first().hasClass("hidden")?s:this.nextAnchor(s)},t.prototype.prevAnchor=function(t){var e,s;return e=t.parents("li").first(),s=$("a",e.prev()),s&&!s.parents("li").first().hasClass("hidden")?s:this.prevAnchor(s)},t.prototype.hasFocus=function(){return $("*:focus",this.container).length>0},t.prototype.checkItemLabel=function(t){return null==t.label?t.label=t[this.options.labelMethod]:void 0},t.prototype.createListItemFromJson=function(t){return $.handlebar(this.options.listItemTemplate,t)},t.prototype.delayedSearch=function(){return null!=this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.bind(this.createListFromSource),500)},t.prototype.search=function(t){var e;return e=new RegExp(t,"i"),$(".plush-list-item a",this.container).each(function(){var t;return t=$(this).parents(".plush-list-item").first(),e.test($(this).html())?t.hasClass("disabled")?void 0:t.removeClass("hidden"):t.addClass("hidden")}),$(".plush-optgroup",this.container).each(function(){var t;return t=$(this),0===$(".plush-list-item:not(.hidden)",t).length?t.hide():t.show()}),this.resizeList(),this.checkResults()},t.prototype.checkResults=function(){return 0===$("li:not(.hidden)",this.list).length?this.showNoResults():this.hideNoResults()},t.prototype.showNoResults=function(){var t;return t=this.options.noResultsMessage+this.input.val(),0===$(".plush-no-results",this.list).length?this.list.append($.handlebar(this.options.noResultsTemplate,{message:t})):($(".plush-no-results",this.list).html(t),$(".plush-no-results",this.list).show())},t.prototype.hideNoResults=function(){return $(".plush-no-results",this.list).hide()},t.prototype.resizeList=function(){return"top"===this.options.position?this.list.css("top","-"+this.list.outerHeight(!0)+"px"):void 0},t.prototype.show=function(){return this.placeholder.hide(),this.input.css("display","block"),this.inputContainer.addClass("opened"),this.list.show(),this.input.is(":focus")?void 0:this.input.focus()},t.prototype.hide=function(t){return null==t&&(t=!1),!this.hasFocus()||t?(this.showPlaceholder(),this.inputContainer.removeClass("opened"),this.input.hide(),this.list.hide()):void 0},t.prototype.showPlaceholder=function(){return this.placeholder.show()},t.prototype.getAttributesFromElement=function(t,e){var s,n,i,l,a;for(n={},a=t.attributes,i=0,l=a.length;l>i;i++)s=a[i],s.nodeName.match(e)&&(n[s.nodeName.replace(e,"")]=s.nodeValue);return n},t.prototype.getDataFromElement=function(t){return this.getAttributesFromElement(t,/^data-/)},t.prototype.getQueryDataFromElement=function(t){return this.getAttributesFromElement(t,/^data-query-/)},t.prototype.bind=function(t){var e=this;return function(){return t.apply(e,arguments)}},t}()}.call(this),function(){Plush.prototype.setEventHandlers=function(){var t=this;return this.inputContainer.on("click",".plush-placeholder, .plush-caret",function(e){return e.preventDefault(),t.show()}),this.container.on("blur","input, a",function(){return setTimeout(t.bind(t.hide),100)}),this.input.on("focus",function(){return t.inputContainer.hasClass("opened")?void 0:t.show()}).on("keyup",function(e){return e.stopPropagation(),t.handleInputKeyPress(e)}),this.list.on("mousedown keydown keyup","a",function(t){return t.preventDefault(),t.stopPropagation()}).on("mousedown","a",function(e){return t.setOptionFor($(e.currentTarget).parents("li").first())}).on("click","a",function(t){return t.preventDefault()}).on("keyup","a",function(e){return t.handleListKeyPress(e)}).on("blur","a",function(){return $(this).removeClass("focused")}),this.element.trigger("initialized")},Plush.prototype.handleInputKeyPress=function(t){return 38!==t.which&&40!==t.which?27===t.which?this.input.blur():this.searchWithAjax?this.delayedSearch():this.search(this.input.val()):(t.preventDefault(),38===t.which&&this.focusAnchor($("li:not(.hidden):last a",this.list)),40===t.which?this.focusAnchor($("li:not(.hidden):first a",this.list)):void 0)},Plush.prototype.handleListKeyPress=function(t){var e,s,n;return e=$(t.currentTarget),(38===t.which||40===t.which)&&(38===t.which&&(n=this.prevAnchor(e)),40===t.which&&(n=this.nextAnchor(e)),!n.length>0?this.input.focus():this.focusAnchor(n)),27===t.which&&this.input.focus(),13===t.which?(e=$(t.currentTarget),s=e.parents("li").first(),this.setOptionFor(s),this.blurAnchor(e)):void 0}}.call(this),function(){Plush.prototype.createListFromOptions=function(){var t=this;return $("option",this.element).each(function(e,s){return t.list.append(t.createListItemFromOption(s))})},Plush.prototype.createListFromGroupedOptions=function(){var t=this;return $("optgroup",this.element).each(function(e,s){var n,i;return i=$(s),n=$.handlebar("plush_optgroup_item",{label:i.attr("label")}),$("option",i).each(function(e,s){return $(".plush-optgroup-list",n).append(t.createListItemFromOption(s))}),t.list.append(n)})},Plush.prototype.createListItemFromOption=function(t){var e,s;return e=$(t),s=this.getDataFromElement(t),s.value=e.val(),s.label=e.html(),$.handlebar(this.options.listItemTemplate,s)},Plush.prototype.createListFromSource=function(t){var e,s,n=this;return null==t&&(t=!1),this.inputContainer.addClass("loading"),e={url:this.options.url,type:"get",dataType:"json"},s=$.extend({},this.queryData),this.searchWithAjax&&(s[this.options.queryDefault]=this.input.val()),e.data=s,$.ajax(e).done(function(e){return n.createListFromJSON(e,t)}).always(function(){return n.inputContainer.removeClass("loading"),n.checkResults()})},Plush.prototype.createListFromJSON=function(t,e){var s,n,i,l,a,r,o,h,u,p,c;if(null==t&&(t=[]),null==e&&(e=!1),this.list.empty(),null!=t&&!$.isEmptyObject(t)){if($.inArray("value",Object.keys(t[0]))>=0)for(a=0,h=t.length;h>a;a++)l=t[a],this.checkItemLabel(l),this.list.append(this.createListItemFromJson(l)),this.element.append("<option value="+l.value+">"+l.label+"</option>");else for(r=0,u=t.length;u>r;r++){for(i=t[r],n=Object.keys(i)[0],s=$.handlebar(this.options.optgroupTemplate,{label:n}),c=i[n],o=0,p=c.length;p>o;o++)l=c[o],this.checkItemLabel(l),$("ul",s).append(this.createListItemFromJson(l));this.list.append(s)}return e||this.input.focus(),this.checkResults()}}}.call(this),function(){var t={}.hasOwnProperty,e=function(e,s){function n(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return n.prototype=s.prototype,e.prototype=new n,e.__super__=s.prototype,e};this.PlushMulti=function(t){function s(t,e){this.element=t,this.options=null!=e?e:{},this.defaults.dragDrop=!1,s.__super__.constructor.call(this,this.element,this.options={})}return e(s,t),s.prototype.addClassnames=function(){return this.container.addClass("plush-multiple"),this.options.dragDrop&&this.container.addClass("plush-drag-drop"),s.__super__.addClassnames.call(this)},s.prototype.setPlaceholders=function(){return null},s.prototype.setup=function(){var t,e,s,n,i,l=this;for(s=$("option[selected]",this.element),this.element.html(""),n=0,i=s.length;i>n;n++)e=s[n],t=$(e),this.addMultiSelectItem(t.html(),t.val());return this.options.dragDrop?this.inputContainer.sortable({items:"> .plush-multi-select-item",placeholder:"plush-drag-placeholder",forcePlaceholderSize:!0,stop:function(t,e){return l.moveMultiSelectItem(e.item)}}):void 0},s.prototype.showPlaceholder=function(){return $(".plush-multi-select-item",this.inputContainer).length>0?this.placeholder.hide():this.placeholder.show()},s.prototype.setOptionFor=function(t){var e;return e=t.data("value"),this.getOption(e).length>0?void 0:this.addMultiSelectItem(t.data("label"),e)},s.prototype.addMultiSelectItem=function(t,e){var s;return s=$.handlebar(this.options.multiSelectTemplate,{label:t,value:e}),$(".plush-multi-select-item",this.inputContainer).length>0?$(".plush-multi-select-item",this.inputContainer).last().after(s):this.inputContainer.prepend(s),this.createOption(t,e),this.element.trigger("change")},s.prototype.moveMultiSelectItem=function(t){var e,s,n;return e=this.getOption(t.data("value")),t.prev().length>0?(s=t.prev(),n=$("[value="+s.data("value")+"]",this.element),$(n,this.element).after(e)):this.element.prepend(e),this.element.trigger("change")},s.prototype.setEventHandlers=function(){var t=this;return this.inputContainer.on("click",".plush-remove",function(e){var s;return e.preventDefault(),s=$(e.currentTarget).parents(".plush-multi-select-item").first(),t.removeOption(s.data("value")),s.remove(),t.showPlaceholder()}).on("click",function(e){return $(e.target).hasClass("plush-input-wrapper")?t.show():void 0}),s.__super__.setEventHandlers.call(this)},s}(Plush)}.call(this),function(){$(function(){return $("[data-toggle='plush']").plush()})}.call(this),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_image_list_item=t(function(t,e,s,n,i){this.compilerInfo=[4,">= 1.0.0"],s=this.merge(s,t.helpers),i=i||{};var l,a="",r="function",o=this.escapeExpression;return a+="<li class='plush-list-item plush-imagebox' data-label='",(l=s.label)?l=l.call(e,{hash:{},data:i}):(l=e&&e.label,l=typeof l===r?l.call(e,{hash:{},data:i}):l),a+=o(l)+"' data-value='",(l=s.value)?l=l.call(e,{hash:{},data:i}):(l=e&&e.value,l=typeof l===r?l.call(e,{hash:{},data:i}):l),a+=o(l)+"'>\n  <a href='#'>\n    <img src='",(l=s.image)?l=l.call(e,{hash:{},data:i}):(l=e&&e.image,l=typeof l===r?l.call(e,{hash:{},data:i}):l),a+=o(l)+"'>\n    <span class='title'>",(l=s.label)?l=l.call(e,{hash:{},data:i}):(l=e&&e.label,l=typeof l===r?l.call(e,{hash:{},data:i}):l),a+=o(l)+"</span>\n    <span class='description'>",(l=s.description)?l=l.call(e,{hash:{},data:i}):(l=e&&e.description,l=typeof l===r?l.call(e,{hash:{},data:i}):l),a+=o(l)+"</span>\n  </a>\n</li>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_input=t(function(t,e,s,n,i){this.compilerInfo=[4,">= 1.0.0"],s=this.merge(s,t.helpers),i=i||{};var l,a="",r="function",o=this.escapeExpression;return a+="<div class='plush-input-wrapper'>\n  <div class='plush-placeholder'>",(l=s.placeholder)?l=l.call(e,{hash:{},data:i}):(l=e&&e.placeholder,l=typeof l===r?l.call(e,{hash:{},data:i}):l),a+=o(l)+"</div>\n  <input class='plush-input' type='text' value='",(l=s.value)?l=l.call(e,{hash:{},data:i}):(l=e&&e.value,l=typeof l===r?l.call(e,{hash:{},data:i}):l),a+=o(l)+"'>\n  <div class='plush-caret'></div>\n</div>\n<ul class='plush-option-list'></ul>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_list_item=t(function(t,e,s,n,i){this.compilerInfo=[4,">= 1.0.0"],s=this.merge(s,t.helpers),i=i||{};var l,a="",r="function";return a+="<li class='plush-list-item' data-label='",(l=s.label)?l=l.call(e,{hash:{},data:i}):(l=e&&e.label,l=typeof l===r?l.call(e,{hash:{},data:i}):l),(l||0===l)&&(a+=l),a+="' data-value='",(l=s.value)?l=l.call(e,{hash:{},data:i}):(l=e&&e.value,l=typeof l===r?l.call(e,{hash:{},data:i}):l),(l||0===l)&&(a+=l),a+="'>\n  <a href='#'>",(l=s.label)?l=l.call(e,{hash:{},data:i}):(l=e&&e.label,l=typeof l===r?l.call(e,{hash:{},data:i}):l),(l||0===l)&&(a+=l),a+="</a>\n</li>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_multi_select_item=t(function(t,e,s,n,i){this.compilerInfo=[4,">= 1.0.0"],s=this.merge(s,t.helpers),i=i||{};var l,a="",r="function",o=this.escapeExpression;return a+="<div class='plush-multi-select-item' data-value='",(l=s.value)?l=l.call(e,{hash:{},data:i}):(l=e&&e.value,l=typeof l===r?l.call(e,{hash:{},data:i}):l),a+=o(l)+"'>\n  <span>",(l=s.label)?l=l.call(e,{hash:{},data:i}):(l=e&&e.label,l=typeof l===r?l.call(e,{hash:{},data:i}):l),a+=o(l)+"</span>\n  <a class='plush-remove'></a>\n</div>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_no_results=t(function(t,e,s,n,i){this.compilerInfo=[4,">= 1.0.0"],s=this.merge(s,t.helpers),i=i||{};var l,a="",r="function",o=this.escapeExpression;return a+="<div class='plush-no-results'>\n  ",(l=s.message)?l=l.call(e,{hash:{},data:i}):(l=e&&e.message,l=typeof l===r?l.call(e,{hash:{},data:i}):l),a+=o(l)+"\n</div>\n"})}(),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.plush_optgroup_item=t(function(t,e,s,n,i){this.compilerInfo=[4,">= 1.0.0"],s=this.merge(s,t.helpers),i=i||{};var l,a="",r="function";return a+="<li class='plush-optgroup'>\n  <div class='plush-optgroup-label'>",(l=s.label)?l=l.call(e,{hash:{},data:i}):(l=e&&e.label,l=typeof l===r?l.call(e,{hash:{},data:i}):l),(l||0===l)&&(a+=l),a+="</div>\n  <ul class='plush-optgroup-list'></ul>\n</li>\n"})}(),function(){}.call(this);